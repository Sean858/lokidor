<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link rel="stylesheet" type="text/css" href="css/styles.css">
    <link rel="stylesheet" type="text/css" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.3/css/all.css" integrity="sha384-UHRtZLI+pbxtHCWp1t77Bi1L4ZtiqrqD80Kn4Z8NTSRyMA2Fd33n5dQ8lWUE00s/" crossorigin="anonymous">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
</head>
<body id="setSchedule">
    <div id="header">
        <nav class="navbar navbar-expand-lg navbar-light bg-light">
            <a class="navbar-brand" href="#">Lokidor</a>
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav">
                    <li class="nav-item active">
                        <a class="nav-link" href="/">Home</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="setSchedule">Set Schedule <span class="sr-only">(current)</span></a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="viewActivity">View Activity</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="reportTrafficking">Report Trafficking</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="contactUs">Contact Us</a>
                    </li>
                </ul>
            </div>
        </nav>
    </div>

    <div id="main">
        <div><h2>Set Location Schedule</h2></div>
        <div id="introduction"></div>
        <div><button onclick="addItem()">add more </button></div>
        <div>
            <span class="buckinput">Start: </span><span class="buckinput">End: </span><span class="buckinput">Location: </span>
        </div>
        <!-- dynamic form -->
        <div id="fm">
        </div>
        <div>Contact Email: <input type="text" id="emailAddr" value="example@gmail.com" /></div>
        <div><button onclick="addSchedule()">submit</button></div>
    </div>

    <!-- Footer -->
    <footer class="page-footer font-small bg-light pt-4 fixed-bottom">

        <!-- Footer Elements -->
        <div class="container">

            <!-- Social buttons -->
            <ul class="list-unstyled list-inline text-center">
                <li class="list-inline-item">
                    <a class="btn-floating btn-fb mx-1" href="https://www.facebook.com/martin.yang.167189">
                        <i class="fab fa-facebook-f"> </i>
                    </a>
                </li>
                <li class="list-inline-item">
                    <a class="btn-floating btn-tw mx-1" href="https://twitter.com/SuperMartinYang">
                        <i class="fab fa-twitter"> </i>
                    </a>
                </li>
                <li class="list-inline-item">
                    <a class="btn-floating btn-gplus mx-1" href="https://plus.google.com/u/0/113631933804634612497?tab=kX">
                        <i class="fab fa-google-plus-g"> </i>
                    </a>
                </li>
                <li class="list-inline-item">
                    <a class="btn-floating btn-li mx-1" href="https://www.linkedin.com/in/supermartinyang/">
                        <i class="fab fa-linkedin-in"> </i>
                    </a>
                </li>
                <li class="list-inline-item">
                    <a class="btn-floating btn-dribbble mx-1" href="#">
                        <i class="fab fa-dribbble"> </i>
                    </a>
                </li>
            </ul>
            <!-- Social buttons -->

        </div>
        <!-- Footer Elements -->

        <!-- Copyright -->
        <div class="footer-copyright bg-secondary text-center py-3">Â© 2018 Copyright:
            <a href="/" style="color:white"> lokidor.com</a>
        </div>
        <!-- Copyright -->

    </footer>
    <!-- Footer -->

    <script>
        var addid = 0;
        function createGroup(fm){
            addid++;

            var text = document.createElement('div');
            text.id = 'additem_' + addid;
            text.innerHTML = "<input type='time' value='' class='buckinput' name='items[]' /><input type='time' value='' class='buckinput' name='items[]' /><input type='text' value='' class='buckinput' id='location"+ addid +"' name='items[]' onclick='popUpMap("+ addid +")' /><img src='images/deletered.png' id='deleteRed' onclick='deleteItem(" + addid + ")'/>";

            fm.appendChild(text);
        }
        function addItem() {
            var fm = document.getElementById("fm");
            createGroup(fm);
        }
        function deleteItem(id){
            var element = document.getElementById("additem_" + id);
            element.parentNode.removeChild(element);
        }

        addItem()

        function popUpMap(id){
            var node = document.getElementById("location" + id);
            console.log(node);
            if (node.value === ""){
                var popup = window.open("selectMap/" + id, "Popup", "width=800,height=450");
                popup.focus();
            }
        }
        function addSchedule(){
            // use ajax to post schedule information
            // add schedule info
            var schedule = [];
            var fm = document.getElementById("fm");
            var nodes = fm.childNodes;
            console.log(nodes);
            for (var id = 1; id < nodes.length; id ++) {
                var mp = {};
                var inputs = nodes[id].childNodes;
                console.log(inputs);
                mp["start"] = inputs[0].value;
                mp["stop"] = inputs[1].value;
                mp["location"] = inputs[2].value;
                schedule.push(mp);
            }

            console.log(schedule);
            // add email info
            var email = document.getElementById("emailAddr").value;
            // do query
            $.ajax({
                type: "POST",
                url: "setSchedule",
                dataType: "json",
                contentType: "application/json; charset=utf-8",
                success: function(msg) {
                    if (msg){
                        alert("Schedule Setup Finished.");
                    } else {
                        alert("Schedule Setup Failed.");
                    }
                    location.reload(true);
                },
                data: JSON.stringify({"schs": schedule, "email": email})
            })
        }
    </script>
</body>
</html>